#!/bin/bash

RED=$(tput -Txterm setaf 1)
GREEN=$(tput -Txterm setaf 2)
UNDERLINE="$(tput smul)"
NORMAL="$(tput sgr0)"
BOLD="$(tput bold)"
STATUS=0

title() {
  echo "${UNDERLINE}${BOLD}${1}${NORMAL}"
}

panic() {
  printf "\n\n\t%s\n\n" "$1"
  exit 1
}

NAME=$(git branch | sed 's/* //')
if [ "$NAME" != '(no branch)' ]; then
  title "Format"
  make fmt

  title "Vet"
  make vet

  title "Test"
  make test

  echo
  echo "Hook ${bold}${green}succeeded${normal}, proceeding to commit."
  echo
fi

if [ $STATUS -ne 0 ]; then
  panic "Hook ${BOLD}${RED}failed${NORMAL}, please check your code."
fi
